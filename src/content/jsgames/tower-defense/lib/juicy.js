"use strict";Phaser.Plugin.Juicy=function(e){Phaser.Plugin.call(this,e),this._boundsCache=Phaser.Utils.extend(!1,{},this.game.world.bounds),this._shakeWorldMax=20,this._shakeWorldTime=0,this._trailCounter=0,this._overScales={},this._overScalesCounter=0},Phaser.Plugin.Juicy.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Juicy.prototype.constructor=Phaser.Plugin.Juicy,Phaser.Plugin.Juicy.ScreenFlash=function(e,t){t=t||"white";var i=e.add.bitmapData(e.width,e.height);i.ctx.fillStyle=t,i.ctx.fillRect(0,0,e.width,e.height),Phaser.Sprite.call(this,e,0,0,i),this.alpha=0},Phaser.Plugin.Juicy.ScreenFlash.prototype=Object.create(Phaser.Sprite.prototype),Phaser.Plugin.Juicy.ScreenFlash.prototype.constructor=Phaser.Plugin.Juicy.ScreenFlash,Phaser.Plugin.Juicy.ScreenFlash.prototype.flash=function(e,t){e=e||1,t=t||100;var i=this.game.add.tween(this).to({alpha:e},100,Phaser.Easing.Bounce.InOut,!0,0,0,!0);i.onComplete.add(function(){this.alpha=0},this)},Phaser.Plugin.Juicy.Trail=function(e,t,i){Phaser.Graphics.call(this,e,0,0),this.target=null,this.trailLength=t||10,this.trailWidth=15,this.trailScaling=!1,this.trailColor=i||16777215,this._segments=[],this._verts=[],this._indices=[]},Phaser.Plugin.Juicy.Trail.prototype=Object.create(Phaser.Graphics.prototype),Phaser.Plugin.Juicy.Trail.prototype.constructor=Phaser.Plugin.Juicy.Trail,Phaser.Plugin.Juicy.Trail.prototype.drawPolygon=function(e){this.moveTo(e.points[0].x,e.points[0].y);for(var t=1;t<e.points.length;t+=1)this.lineTo(e.points[t].x,e.points[t].y);this.lineTo(e.points[0].x,e.points[0].y)},Phaser.Plugin.Juicy.Trail.prototype.update=function(){this.target&&(this.x=this.target.x,this.y=this.target.y)},Phaser.Plugin.Juicy.Trail.prototype.addSegment=function(e,t){for(var i;this._segments.length>this.trailLength;)i=this._segments.shift();i||(i=new Phaser.Point),i.x=e,i.y=t,this._segments.push(i)},Phaser.Plugin.Juicy.Trail.prototype.redrawSegments=function(e,t){this.clear();var i,s,a,h,r=0,n=0,o=0;this._verts.length!==4*(this._segments.length-1)&&(this._verts=[]);for(var l=0;l<this._segments.length;++l){if(i=this._segments[l],s){h=Math.atan2(i.y-s.y,i.x-s.x)+Math.PI/2,n=Math.sin(h),o=Math.cos(h);for(var c=0;2>c;++c)a=(-.5+c/1)*this.trailWidth,this.trailScaling&&(a*=l/this._segments.length),this._verts[r++]=i.x+o*a-e,this._verts[r++]=i.y+n*a-t}s=i.copyTo({})}if(this._verts.length>=8){for(var u=0;u<this._verts.length;u++)this._indices[6*u+0]=2*u+0,this._indices[6*u+1]=2*u+1,this._indices[6*u+2]=2*u+2,this._indices[6*u+3]=2*u+1,this._indices[6*u+4]=2*u+2,this._indices[6*u+5]=2*u+3;this.beginFill(this.trailColor),this.drawTriangles(this._verts,this._indices),this.endFill()}},Phaser.Plugin.Juicy.prototype.shake=function(e,t){this._shakeWorldTime=e||20,this._shakeWorldMax=t||20,this.game.world.setBounds(this._boundsCache.x-this._shakeWorldMax,this._boundsCache.y-this._shakeWorldMax,this._boundsCache.width+this._shakeWorldMax,this._boundsCache.height+this._shakeWorldMax)},Phaser.Plugin.Juicy.prototype.createScreenFlash=function(e){return new Phaser.Plugin.Juicy.ScreenFlash(this.game,e)},Phaser.Plugin.Juicy.prototype.createTrail=function(e,t){return new Phaser.Plugin.Juicy.Trail(this.game,e,t)},Phaser.Plugin.Juicy.prototype.overScale=function(e,t,i){t=t||1.5;var s=this._overScalesCounter++;i=i||new Phaser.Point(1,1);var a=this._overScales[s];a||(a={object:e,cache:i.copyTo({})}),a.scale=t,this._overScales[s]=a},Phaser.Plugin.Juicy.prototype.jelly=function(e,t,i,s){t=t||.2,i=i||0,s=s||new Phaser.Point(1,1),this.game.add.tween(e.scale).to({x:s.x+s.x*t},50,Phaser.Easing.Quadratic.InOut,!0,i).to({x:s.x},600,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(e.scale).to({y:s.y+s.y*t},50,Phaser.Easing.Quadratic.InOut,!0,i+50).to({y:s.y},600,Phaser.Easing.Elastic.Out,!0)},Phaser.Plugin.Juicy.prototype.mouseStretch=function(e,t,i){t=t||.5,i=i||new Phaser.Point(1,1),e.scale.x=i.x+Math.abs(e.x-this.game.input.activePointer.x)/100*t,e.scale.y=i.y+i.y*t-e.scale.x*t},Phaser.Plugin.Juicy.prototype.update=function(){var e;if(this._shakeWorldTime>0){var t=this._shakeWorldTime/this._shakeWorldMax*this._shakeWorldMax,i=this.game.rnd.integerInRange(-t,t),s=this.game.rnd.integerInRange(-t,t);this.game.camera.x=i,this.game.camera.y=s,this._shakeWorldTime--,this._shakeWorldTime<=0&&this.game.world.setBounds(this._boundsCache.x,this._boundsCache.x,this._boundsCache.width,this._boundsCache.height)}for(var a in this._overScales)this._overScales.hasOwnProperty(a)&&(e=this._overScales[a],e.scale>.01?(e.object.scale.x=e.scale*e.cache.x,e.object.scale.y=e.scale*e.cache.y,e.scale-=this.game.time.elapsed*e.scale*.35):(e.object.scale.x=e.cache.x,e.object.scale.y=e.cache.y,delete this._overScales[a]))},"object"==typeof module&&module.exports&&(module.exports=Phaser.Plugin.Juicy),Phaser.Graphics.prototype.drawTriangle||(Phaser.Graphics.prototype.drawTriangle=function(e,t){var i=new Phaser.Polygon(e);if(t){var s=new Phaser.Point(this.game.camera.x-e[0].x,this.game.camera.y-e[0].y),a=new Phaser.Point(e[1].x-e[0].x,e[1].y-e[0].y),h=new Phaser.Point(e[1].x-e[2].x,e[1].y-e[2].y),r=h.cross(a);s.dot(r)>0&&this.drawPolygon(i)}else this.drawPolygon(i)},Phaser.Graphics.prototype.drawTriangles=function(e,t,i){var s,a=new Phaser.Point,h=new Phaser.Point,r=new Phaser.Point,n=[];if(t)if(e[0]instanceof Phaser.Point)for(s=0;s<t.length/3;s++)n.push(e[t[3*s]]),n.push(e[t[3*s+1]]),n.push(e[t[3*s+2]]),3===n.length&&(this.drawTriangle(n,i),n=[]);else for(s=0;s<t.length;s++)a.x=e[2*t[s]],a.y=e[2*t[s]+1],n.push(a.copyTo({})),3===n.length&&(this.drawTriangle(n,i),n=[]);else if(e[0]instanceof Phaser.Point)for(s=0;s<e.length/3;s++)this.drawTriangle([e[3*s],e[3*s+1],e[3*s+2]],i);else for(s=0;s<e.length/6;s++)a.x=e[6*s+0],a.y=e[6*s+1],h.x=e[6*s+2],h.y=e[6*s+3],r.x=e[6*s+4],r.y=e[6*s+5],this.drawTriangle([a,h,r],i)});
